define(["app"], function (BrewOptix) {

    BrewOptix.module("Entities", function (Entities, BrewOptix, Backbone, Marionette, $, _) {
        Entities.Package = Backbone.Model.extend({
            urlRoot: BrewOptix.url("Package"),
            idAttribute: "EntityID"
        });

        Entities.PackageCollection = Backbone.Collection.extend({
            url: BrewOptix.url("Package"),
            model: Entities.Package
        });

        Entities.PackageType = Backbone.Model.extend({});

        Entities.PackageTypeCollection = Backbone.Collection.extend({
            model: Entities.PackageType
        });

        var packages;

        var api = {
            getPackages: function () {
                if (packages !== undefined) {
                    return packages;
                }
                packages = new Entities.BrandCollection();

                packages.add(new Entities.Package({ Name: "12oz", Type: "Case" }));
                packages.add(new Entities.Package({ Name: "22oz", Type: "Case" }));
                packages.add(new Entities.Package({ Name: "15.5gal", Type: "Draft" }));
                packages.add(new Entities.Package({ Name: "5.17gal", Type: "Draft" }));

                return packages;
            }
        };

        BrewOptix.reqres.setHandler("package:entities", function () { return api.getPackages(); });

        BrewOptix.reqres.setHandler("package:entities:bytype", function (packageType) {
            var unfilteredPackages = api.getPackages();
            var filteredPackages = unfilteredPackages.where({ Type: packageType });

            return new Entities.PackageCollection(filteredPackages);
        });

        BrewOptix.reqres.setHandler("packageType:entities", function () {
            var packageTypes = new Entities.PackageTypeCollection();

            packageTypes.add(new Entities.PackageType({ Type: "Case" }));
            packageTypes.add(new Entities.PackageType({ Type: "Draft" }));

            return packageTypes;

        });
    });

    return BrewOptix.Entities.Package;
});
