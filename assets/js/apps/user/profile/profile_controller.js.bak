define(["app"], function (BrewOptix) {
    BrewOptix.module("UserApp.Profile", function (Profile, BrewOptix, Backbone, Marionette, $, _) {
        Profile.Controller = {
            getProfile: function() {
                require(["entities/userProfile"], function() {

                    var fetchingProfile = BrewOptix.request("userProfile:entity");

                    var promises = [fetchingProfile];

                    $.when.apply($, promises).then(function(data) {
                        $('.js-profile_fullName').html(data.get('DisplayName'));
                        $('.js-profile_photo').attr('src', 'http://www.gravatar.com/avatar/' + data.get('EmailHash') + '?d=identicon');
                        BrewOptix.DisplayName = data.get('DisplayName');
                        BrewOptix.Email = data.get('Email');
                        BrewOptix.UserAccountID = data.get('UserAccountID');
                        BrewOptix.displayNavigation();

                        UserVoice.push(['identify', {
                            email:      BrewOptix.Email,
                            name:       BrewOptix.DisplayName,
                            id:         BrewOptix.UserAccountID
                        }]);
                    });
                });
            }
        };
    });

    return BrewOptix.UserApp.Profile.Controller;
});